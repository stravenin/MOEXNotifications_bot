
## Структура проекта

Проект организован по принципу многоуровневой архитектуры, что позволяет разделить ответственность между различными компонентами системы. Ниже представлена структура проекта и описание каждого слоя.

```
├── migrations                   # Миграции
└── app
    ├── core
    │ ├── config.py         # Константы, используемые по всему проекту
    │ ├── database.py       # Клиенты баз данных
    │ ├── dependencies.py   # Зависимости
    │ └── schemas.py        # Pydantic модели
    ├── models                # Модели базы данных
    ├── repository            # Слой взаимодействия с базой данных
    ├── services              # Слой бизнес логики
    ├── utils                 
    │  ├── keyboards.py      # Основные клавиатуры
    │  ├── middlewares.py    # Мидлвары
    │  ├── scheduled.py      # Отложенные функции
    │  └── unitofwork.py     # Класс для реализации UOW
    └── handlers.py       # Хендлеры
```

### CORE

Слой core отвечает за основные настройки и конфигурацию приложения.

* `config.py`: файл с конфигурацией, который загружает переменные окружения, необходимые для работы приложения. Здесь можно настроить параметры подключения к базе данных и другие важные параметры.

* `database.py`: модуль, отвечающий за создание подключения к базе данных. В этом файле определяются настройки подключения и инициализация ORM (SQLAlchemy).

* `dependencies.py`: содержит зависимости для подключения различных сервисов и компонентов приложения. Это упрощает управление зависимостями и их переиспользование в разных частях приложения.

* `schemas.py`: в пакете `schemas` находятся схемы, описанные с помощью библиотеки `Pydantic`.


### MODELS

Слой моделей  `SQLAlchemy`, описывающих таблицы в базе данных. Слой `models` реализует модели `SQLAlchemy`, описывающие таблицы в базе данных. Каждая модель соответствует определённой таблице, а её атрибуты — столбцам таблицы. Этот слой обеспечивает взаимодействие с данными на уровне объектов.

### REPOSITORY

Слой repository отвечает за выполнение запросов к базе данных. Здесь реализованы методы для выполнения CRUD операций (создание, чтение, обновление, удаление) с использованием моделей из слоя models. Этот слой абстрагирует доступ к данным и позволяет изолировать логику работы с базой данных от других слоёв приложения.

### SERVICES

Сервисный уровень (пакет services) обеспечивает защиту слоя `handlers` от изменений в механизмах доступа к данным. Основные функции сервиса:

* Централизация механизма логирования ошибок и сбора дополнительной информации без привязки к конкретным хендлерам.

* Проверка и форматирование данных перед их отправкой в базу данных.

* Взаимодействие с репозиториями для выполнения бизнес-логики.

Хендлеры вызывают методы сервиса, а сервисы уже взаимодействуют с данными через слой репозитория. Это позволяет поддерживать чистоту кода и облегчает тестирование.

### UTILS

В пакете `utils` находятся вспомогательные функции и классы, которые могут быть использованы в различных частях приложения.

* `keyboards.py`: отвечает за создание inline и reply клавиатур.

* `middlewares.py`: реализация инъекции зависимостей в хендлеры.

* `scheduled.py`: функция проверки текущих цен, вызов которой происходит с помощью `aiocron`.

* `unitofwork.py`: реализация паттерна Unit of Work, который управляет транзакциями и обеспечивает согласованность данных при выполнении нескольких операций над базой данных.

## Unit of Work (UoW)

Паттерн Unit of Work (UoW) широко используется в архитектуре программного обеспечения для управления транзакциями и обеспечения атомарности операций с базой данных. 
#### Основные принципы работы UoW

Обычно, для каждой группы роутов создается свой сервис, то есть, один сервис для пользователей покроет все потребности в работе с пользователем.

1. Атомарность: UoW обеспечивает выполнение всех операций в рамках одной транзакции. Если одна из операций не удалась, все изменения, сделанные до этого момента, будут отменены.

2. Координация изменений: UoW отслеживает изменения, внесенные в репозитории, и управляет их сохранением в базу данных.

3. Изоляция репозиториев: Каждый репозиторий может быть использован независимо, но UoW объединяет их действия в одну транзакцию.
